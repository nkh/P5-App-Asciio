<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Cross algorithm - Asciio</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Asciio</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="basic-introduction"><a class="header" href="#basic-introduction">Basic introduction</a></h1>
<p>When the borders of two text elements intersect, we generate some
compensating characters to cover the borders, resulting in nicer graphics</p>
<pre><code>          |            ││    │  │
          |            ││    │  │
     -----|---&gt;      ──││────│──│─
          |            ││    │  │
          |            ││    │  │
          v
</code></pre>
<p>Look at the text above, their borders are overlapping each other.
The text we need to generate is as follows:</p>
<pre><code>          |            ││    │  │
          |            ││    │  │
     -----+---&gt;      ──┼┼────┼──┼─
          |            ││    │  │
          |            ││    │  │
          v

</code></pre>
<p>We need to generate padding characters at their boundaries,
then the steps are as follows:</p>
<ol>
<li>find the cross point.</li>
<li>Determine the characters to be filled at the current cross
point according to the characters around the cross point.</li>
<li>Determine whether the current cross point has the
expected fill character, if so, keep it, if not, add it,
and delete the old fill character.</li>
<li>remove all filling characters that are not at cross points.</li>
<li>update drawing.</li>
</ol>
<h1 id="detailed-steps"><a class="header" href="#detailed-steps">Detailed steps</a></h1>
<h2 id="1-find-the-cross-point"><a class="header" href="#1-find-the-cross-point">1 Find the cross point</a></h2>
<p>The cross point must be the coverage of characters,
and the characters that cover each other are the characters we care about.</p>
<blockquote>
<p>The characters we care about refer to commonly used tab characters,
or ascii plus dots, etc.</p>
</blockquote>
<p>Commonly used symbols include these, of course not only these</p>
<pre><code>'-', '|', '.', '\'', '\\', '/', '+', 
'─', '│', '┼', '┤', '├', '┬', '┴', '╭', '╮', '╯', '╰',
'━', '┃', '╋', '┫', '┣', '┳', '┻', '┏', '┓', '┛', '┗', 
'═', '║', '╬', '╣', '╠', '╦', '╩', '╔', '╗', '╝', '╚',
'╫', '╪', '╨', '╧', '╥', '╤', '╢', '╡', '╟', '╞', '╜', 
'╛', '╙', '╘', '╖', '╕', '╓', '╒'
</code></pre>
<p><strong>condition of cross points:</strong></p>
<ol>
<li>text elements crossed</li>
<li>The two characters that intersect each other
are the characters we care about</li>
</ol>
<p>When the condition is found to be met, both characters need to be logged.
At the same time, we need to record the characters around the cross point,
because they absolutely determine what kind of cross point is generated.</p>
<blockquote>
<p>Record the upper, lower, left, and right characters. If you want to achieve
diagonal crossing, you also need to record characters at 45 degrees,
135 degrees, 225 degrees, and 315 degrees.</p>
</blockquote>
<h2 id="2-judgment-scene"><a class="header" href="#2-judgment-scene">2 Judgment scene</a></h2>
<h3 id="21-general-situation"><a class="header" href="#21-general-situation">2.1 General situation</a></h3>
<p>First of all, all cross characters are directional, we need to group
them by direction and type.</p>
<p>Let me give you an example, if the center has generated a character<code>┼</code>,
Then we can use the method of proof by contradiction, its left side
must be these characters, otherwise it is unreasonable.</p>
<pre><code>'─',    '┼',    '├',    '┬',    '┴',    '╭',    '╰'
</code></pre>
<p>These characters all can appear to the left of it(Because their right sides
can be extended to become a line), But if these characters do not appear on
the left side of <code>┼</code>, then we think it is unreasonable to use this <code>┼</code>, and
the disproof condition is false.</p>
<blockquote>
</blockquote>
<pre><code>'-', '|', '.', '\'', '\\', '/', '+', 
'─', '│', '┼', '┤', '├', '┬', '┴', '╭', '╮', '╯', '╰',
'━', '┃', '╋', '┫', '┣', '┳', '┻', '┏', '┓', '┛', '┗', 
'═', '║', '╬', '╣', '╠', '╦', '╩', '╔', '╗', '╝', '╚',
'╫', '╪', '╨', '╧', '╥', '╤', '╢', '╡', '╟', '╞', '╜', 
'╛', '╙', '╘', '╖', '╕', '╓', '╒'
</code></pre>
<p>Make assumptions about the occurrence of each possible padding crossing
character above, untilSupposed to be true.</p>
<pre><code>                             │
                           ──│──
                             │

</code></pre>
<p>For the plus sign, the condition for its appearance is that:</p>
<ol>
<li>A character in the upper character set appears in the upper direction</li>
<li>A character in the down direction character set appears in the down direction</li>
<li>A character in the left-direction character set appears in the left direction</li>
<li>A character in the right-direction character set appears in the right direction</li>
</ol>
<p>If these conditions are met, the intermediate characters can be corrected as <code>┼</code>:</p>
<pre><code>                             │
                           ──┼──
                             │

</code></pre>
<p>Let's look at a more complex situation, The intersection below, we know, needs
one <code>╤</code> to fill.</p>
<pre><code>  ═══│════
     │
     │
</code></pre>
<p>For the <code>╤</code> sign, the condition for its appearance is that:</p>
<ol>
<li>Left is one of the left characters of the double-line character set</li>
<li>Right is one of the right characters of the double-line character set</li>
<li>Down is one of the down characters in the single-line character set</li>
<li>Up <strong>cannot be</strong> one of the up characters in the single-line character set</li>
</ol>
<p>Pay attention to the bold part above, because if this condition is true,
then the filling character should be <code>╪</code>, not <code>╤</code>.</p>
<h3 id="22-improve-efficiency"><a class="header" href="#22-improve-efficiency">2.2 Improve efficiency</a></h3>
<p>There is no need to perform calculations every time to determine the characters
filled in the middle. Whenever a new scene calculation occurs, we can save the
calculation result in a cache and read it directly next time without performing
logical calculations again.</p>
<p>A hash table is most suitable for this, and the hash key can use a combination
of upper, lower, left, and right characters(The oblique lines are the four diagonal
directions.).</p>
<h3 id="23-an-additional-case-needs-to-be-considered-separately"><a class="header" href="#23-an-additional-case-needs-to-be-considered-separately">2.3 An additional case needs to be considered separately</a></h3>
<pre><code>   ││
 ──││─────
   ││
   ││

</code></pre>
<p>please see this text, It is expected that we are going to get the following text:</p>
<pre><code>   ││
 ──┼┼─────
   ││
   ││

</code></pre>
<p>As you noticed, there are two plus signs filled.</p>
<p>Let's take the point that needs to be filled on the left as an example:
<img src="cross_condition.png" alt="cross_condition" /></p>
<p>We can see that characters in three directions meet the requirements,
but characters in one direction <strong>do not meet the requirements</strong>.
But the point on the right is actually also an cross point, it has two
characters, one in the foreground and one in the background. The character
in the background is ok, so we think it ok!</p>
<p><strong>In summary:</strong> If the character next to it is also an cross point, then
either the foreground character or the background character of the
intersection can meet the requirements.So I said earlier that the foreground
and background characters of the cross point all need to be recorded.In fact,
there may be more than one character that meets the condition in the background,
so all of these characters need to be considered, not just limited to 2 characters.</p>
<h3 id="24-the-case-of-character-coverage"><a class="header" href="#24-the-case-of-character-coverage">2.4 The case of character coverage</a></h3>
<p>There is another situation that needs to be explained separately,Similar to
above but slightly different</p>
<pre><code> ╭─────╮
 │ ╭─────╮
 │ │     │
 │ │     │
 ╰─│     │
   ╰─────╯

</code></pre>
<p>The text we need to get is this:</p>
<pre><code> ╭─────╮
 │ ╭───┴─╮
 │ │     │
 │ │     │
 ╰─┤     │
   ╰─────╯

</code></pre>
<p>This looks like two boxes stacked,According to the above statement,
the overlapping parts, both foreground characters and background characters
must be considered.**But not like this!**The overlapping foreground characters
are spaces, and spaces are not characters in the character set, so they are
not considered.</p>
<p><strong>To put it simply:</strong> as long as it is not an cross point, only foreground
characters are considered.</p>
<blockquote>
<p>The definition of the cross point has already been mentioned in the
previous chapter</p>
</blockquote>
<h3 id="25-a-method-to-simplify-logical-judgment"><a class="header" href="#25-a-method-to-simplify-logical-judgment">2.5 A method to simplify logical judgment</a></h3>
<p>When we determine what characters should be filled in a point, we first consider
the characters in the four directions. Then after these characters are considered,
characters in three directions are considered, and finally characters in two directions
are considered. The advantage of this is that if the characters in the four directions
do not meet the conditions, then when judging the characters in the three directions,
there is no need to repeatedly consider that a certain character may be a character
in the four directions, because it has been ruled out before. Similar logic is used
for two-way characters. This can greatly reduce the complexity of logical judgment.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../for_developers/debugging.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../for_developers/unicode_support.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../for_developers/debugging.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../for_developers/unicode_support.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
