# LibAvoid Graph Rendering and Conversion Tools

Complete toolkit for rendering and converting graph layouts generated by libavoid.

## Quick Start

```bash
# Extract
tar -xzf libavoid_tools.tar.gz
cd libavoid_tools

# View interactively
perl libavoid_viewer.pl example_input.txt example_output.txt

# Generate PNG
perl libavoid_render.pl example_input.txt example_output.txt output.png

# Get help
perl libavoid_render.pl -h
perl libavoid_viewer.pl -h
perl libavoid_normalize.pl -h
```

## Requirements

- Perl 5
- Cairo (libcairo-perl)
- GTK3 (libgtk3-perl) - for viewer only

```bash
sudo apt-get install libcairo-perl libgtk3-perl
```

## Files

- **LibAvoidRenderer.pm** - Core rendering module
- **libavoid_render.pl** - PNG/SVG generator
- **libavoid_viewer.pl** - Interactive GTK3 viewer
- **libavoid_normalize.pl** - Format normalizer
- **AsciioToLibAvoid.pm** - Asciio node converter
- **libavoid_colors.conf** - Example color config
- **example_input.txt** - Sample graph
- **example_output.txt** - Sample layout

## Rendering Features

### Default Behavior
- **Auto-scaling:** Graphs automatically scaled to fit
- **Bright colors:** 16 cheerful default colors
- **Smart rendering:** Node IDs only shown in nodes large enough
- **Proper z-order:** Edges drawn on top of ports

### PNG/SVG Generator (libavoid_render.pl)

```bash
perl libavoid_render.pl <input> <layout> <output.png|svg> [options]
```

**Options:**
- `-h, --help` - Show help
- `--border N` - Border pixels (default: 10)
- `--scale FACTOR` - Manual scale
- `--canvas WIDTHxHEIGHT` - Fit to size
- `--no-scale` - Disable auto-scaling
- `--colors FILE` - Color config
- `--show-node-ids` - Show IDs in nodes
- `--antialias` - Smooth rendering
- `--transparent` - PNG transparency
- `--background COLOR` - Background color

**Examples:**
```bash
# High-quality antialiased
perl libavoid_render.pl input.txt layout.txt diagram.png --antialias

# Transparent PNG
perl libavoid_render.pl input.txt layout.txt overlay.png --transparent

# 4K with colors
perl libavoid_render.pl input.txt layout.txt slide.png \
  --canvas 3840x2160 --colors colors.conf --show-node-ids
```

### GTK3 Viewer (libavoid_viewer.pl)

```bash
perl libavoid_viewer.pl <input> <layout> [options]
```

**Keyboard Shortcuts:**
- `+` - Zoom in (×1.5)
- `-` - Zoom out (÷1.5)
- `0` - Reset zoom
- `f` - Fit to window
- `q` - Quit
- `Arrow keys` / `hjkl` - Scroll view

**Mouse:**
- Wheel - Zoom (×1.15 per step)
- Click+Drag - Pan

**Options:**
- `--watch` - Auto-reload on file change
- `--antialias` - Smooth rendering
- All render options supported

**Example:**
```bash
# Development mode
perl libavoid_viewer.pl input.txt layout.txt --watch --antialias
```

## Color Configuration

Create a color file:

```
# Node colors
node 5 #52A0DB
node 6 #66C2A5
default skyblue

# Element colors
port #E74C3C
edge #3498DB
cluster #BDC3C7
background white
```

**Color formats:**
- Hex: `#FF0000`
- RGB: `rgb(255,0,0)`
- Named: `skyblue`, `coral`, `limegreen`, etc.
- Transparent: `transparent` (PNG only)

## Format Normalizer

Convert flexible → strict format:

```bash
# File to file
perl libavoid_normalize.pl input.txt output.txt

# Pipe
cat input.txt | perl libavoid_normalize.pl | other_tool
```

**Flexible features:**
- Case-insensitive commands
- Comments (`#`)
- Blank lines
- Multiple spaces/tabs

**Output:**
- UPPERCASE commands
- No comments
- Single spaces
- Clean formatting

## Asciio Converter

Convert ASCII art boxes to libavoid nodes:

```perl
use AsciioToLibAvoid qw(asciio_node_to_libavoid) ;

my ($node_line, @port_lines) = asciio_node_to_libavoid
                                (
                                $asciio_node,      # Asciio structure
                                $node_id,          # Node ID
                                8,                 # Char width (px)
                                14,                # Char height (px)
                                100,               # Port ID start
                                ) ;
```

## Graph Format

### Input Format

```
GRAPH
NODE <id> <x1> <y1> <x2> <y2> <incoming> <outgoing>
PORT <port_id> <node_id> <side> <x> <y>
EDGE <edge_id> <src_node> <tgt_node> <src_port> <tgt_port>
GRAPHEND
```

**Note:** Port coordinates are relative to node's top-left corner.

### Layout Format

```
LAYOUT
EDGE <id>=<x1 y1 x2 y2 x3 y3 ...>
DONE
```

## Rendering Order

1. Background
2. Clusters (gray)
3. Nodes (colored fills + black borders)
4. Node IDs (if enabled and node ≥15×15px)
5. Ports (red squares)
6. Edges (blue lines + arrows) ← **Drawn last on top**

## Troubleshooting

**Scrollbars not appearing?**
- They appear automatically when zoomed beyond viewport
- Try zooming in with `+` or mouse wheel

**Node IDs not showing?**
- Nodes must be ≥15×15 pixels
- Text must fit within node bounds
- Use `--show-node-ids` flag

**Edges hidden behind ports?**
- Fixed in current version - edges drawn last

**Need help?**
```bash
perl libavoid_render.pl -h
perl libavoid_viewer.pl -h
perl libavoid_normalize.pl -h
```

## Code Style

Whitesmiths indentation with hard tabs.

## Version

Current: All major features implemented with bug fixes.
